<UserControl x:Class="ShoppingOnline.Views.AdminOrdersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- Consolidated local styles -->
    <UserControl.Resources>
        <!-- Status badge for the status column -->
        <Style x:Key="StatusBadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Background" Value="{StaticResource AdminNeutralGray}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Pending">
                    <Setter Property="Background" Value="{StaticResource AdminWarningOrange}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Confirmed">
                    <Setter Property="Background" Value="{StaticResource AdminSuccessGreen}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Shipping">
                    <Setter Property="Background" Value="{StaticResource AdminInfoBlue}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Delivered">
                    <Setter Property="Background" Value="#FF8BC34A"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                    <Setter Property="Background" Value="{StaticResource AdminDangerRed}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Small action buttons -->
        <Style x:Key="ViewButtonStyle" TargetType="Button" BasedOn="{StaticResource AdminSmallButton}">
            <Setter Property="Background" Value="{StaticResource AdminInfoBlue}"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Margin" Value="2"/>
        </Style>

        <Style x:Key="ConfirmButtonStyle" TargetType="Button" BasedOn="{StaticResource AdminSmallButton}">
            <Setter Property="Background" Value="{StaticResource AdminSuccessGreen}"/>
            <Setter Property="Width" Value="65"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Confirmed">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Shipping">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Delivered">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="AssignCarrierButtonStyle" TargetType="Button" BasedOn="{StaticResource AdminSmallButton}">
            <Setter Property="Background" Value="{StaticResource AdminWarningOrange}"/>
            <Setter Property="Width" Value="70"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Delivered">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding HasCarrierAssigned}" Value="True">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="CancelButtonStyle" TargetType="Button" BasedOn="{StaticResource AdminSmallButton}">
            <Setter Property="Background" Value="{StaticResource AdminDangerRed}"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Delivered">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Statistics Cards -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Orders Card -->
            <Border Grid.Column="0" Style="{StaticResource AdminCard}" Margin="0,0,5,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Tong don hang" Style="{StaticResource AdminMutedText}" FontWeight="SemiBold"/>
                    <TextBlock x:Name="TotalOrdersText" Text="0" FontSize="20" FontWeight="Bold" 
                               Foreground="{StaticResource AdminPrimaryRed}" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Pending Orders Card -->
            <Border Grid.Column="1" Style="{StaticResource AdminCard}" Margin="5,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Cho xac nhan" Style="{StaticResource AdminMutedText}" FontWeight="SemiBold"/>
                    <TextBlock x:Name="PendingOrdersText" Text="0" FontSize="20" FontWeight="Bold" 
                               Foreground="{StaticResource AdminWarningOrange}" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Confirmed Orders Card -->
            <Border Grid.Column="2" Style="{StaticResource AdminCard}" Margin="5,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Da xac nhan" Style="{StaticResource AdminMutedText}" FontWeight="SemiBold"/>
                    <TextBlock x:Name="ConfirmedOrdersText" Text="0" FontSize="20" FontWeight="Bold" 
                               Foreground="{StaticResource AdminSuccessGreen}" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Shipping Orders Card -->
            <Border Grid.Column="3" Style="{StaticResource AdminCard}" Margin="5,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Dang giao" Style="{StaticResource AdminMutedText}" FontWeight="SemiBold"/>
                    <TextBlock x:Name="ShippingOrdersText" Text="0" FontSize="20" FontWeight="Bold" 
                               Foreground="{StaticResource AdminInfoBlue}" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Total Order Value Card -->
            <Border Grid.Column="4" Style="{StaticResource AdminCard}" Margin="5,0,0,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Tong gia tri don hang" Style="{StaticResource AdminMutedText}" FontWeight="SemiBold"/>
                    <TextBlock x:Name="TotalRevenueText" Text="0 VND" FontSize="18" FontWeight="Bold" 
                               Foreground="{StaticResource AdminPrimaryRed}" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Search and Filter Bar -->
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Search Box -->
            <Grid Grid.Column="0" Margin="0,0,10,0">
                <TextBox x:Name="OrderSearchBox" Style="{StaticResource AdminTextBox}"
                         TextChanged="OrderSearch_TextChanged"/>
                <TextBlock x:Name="SearchPlaceholder" Text="Tim kiem theo ID don hang, ten khach hang, so dien thoai..." 
                           Style="{StaticResource AdminMutedText}" Margin="15,0,0,0"
                           VerticalAlignment="Center" HorizontalAlignment="Left"
                           IsHitTestVisible="False"/>
            </Grid>

            <!-- Status Filter -->
            <ComboBox x:Name="StatusFilterComboBox" Grid.Column="1" Width="150" 
                      Style="{StaticResource AdminComboBox}" Margin="0,0,10,0"
                      SelectionChanged="StatusFilter_Changed">
                <ComboBoxItem Content="Tat ca trang thai" IsSelected="True"/>
                <ComboBoxItem Content="Pending"/>
                <ComboBoxItem Content="Confirmed"/>
                <ComboBoxItem Content="Shipping"/>
                <ComboBoxItem Content="Delivered"/>
                <ComboBoxItem Content="Cancelled"/>
            </ComboBox>

            <!-- Date Filter -->
            <ComboBox x:Name="DateFilterComboBox" Grid.Column="2" Width="120" 
                      Style="{StaticResource AdminComboBox}" Margin="0,0,10,0"
                      SelectionChanged="DateFilter_Changed">
                <ComboBoxItem Content="Tat ca" IsSelected="True"/>
                <ComboBoxItem Content="Hom nay"/>
                <ComboBoxItem Content="7 ngay qua"/>
                <ComboBoxItem Content="30 ngay qua"/>
                <ComboBoxItem Content="Thang nay"/>
            </ComboBox>

            <!-- Refresh Button -->
            <Button Grid.Column="3" Content="Lam moi" Width="80"
                    Click="RefreshOrders_Click" Style="{StaticResource AdminModernButton}"/>
        </Grid>

        <!-- Orders DataGrid -->
        <Border Grid.Row="2" Style="{StaticResource AdminCard}">
            <DataGrid x:Name="OrdersDataGrid" Style="{StaticResource AdminDataGrid}" RowHeight="55">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding OrderId}" Width="60"/>
                    <DataGridTextColumn Header="Khach hang" Binding="{Binding Customer.FullName}" Width="150"/>
                    <DataGridTextColumn Header="San pham" Binding="{Binding ProductNames}" Width="200"/>
                    <DataGridTextColumn Header="So luong" Binding="{Binding TotalQuantity}" Width="80"/>
                    <DataGridTextColumn Header="So dien thoai" Binding="{Binding Phone}" Width="130"/>
                    <DataGridTextColumn Header="Ngay dat" Binding="{Binding OrderDate, StringFormat=dd/MM/yyyy HH:mm}" Width="130"/>
                    
                    <!-- Carrier Column -->
                    <DataGridTemplateColumn Header="Nguoi giao hang" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding CarrierName}" 
                                           FontSize="11" VerticalAlignment="Center"
                                           ToolTip="{Binding CarrierInfo}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{StaticResource AdminTextSecondary}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CarrierName}" Value="Chua chon">
                                                    <Setter Property="Foreground" Value="{StaticResource AdminWarningOrange}"/>
                                                    <Setter Property="FontStyle" Value="Italic"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding CarrierName}" Value="{x:Null}">
                                                    <Setter Property="Text" Value="Chua chon"/>
                                                    <Setter Property="Foreground" Value="{StaticResource AdminWarningOrange}"/>
                                                    <Setter Property="FontStyle" Value="Italic"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTextColumn Header="Tong tien" Binding="{Binding TotalAmount, StringFormat={}{0:N0} VND}" Width="120"/>
                    
                    <!-- Status Column with Color Coding -->
                    <DataGridTemplateColumn Header="Trang thai" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource StatusBadgeStyle}">
                                    <TextBlock Text="{Binding Status}" Foreground="White" FontWeight="SemiBold" FontSize="11"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Actions Column -->
                    <DataGridTemplateColumn Header="Thao tac" Width="260">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="Xem"
                                            Style="{StaticResource ViewButtonStyle}"
                                            Click="ViewOrderDetail_Click" Tag="{Binding OrderId}"/>
                                    <Button Content="Xac nhan"
                                            Style="{StaticResource ConfirmButtonStyle}"
                                            Click="ConfirmOrder_Click" Tag="{Binding OrderId}"/>
                                    <Button Content="Chon NVC"
                                            Style="{StaticResource AssignCarrierButtonStyle}"
                                            Click="AssignCarrierToOrder_Click" Tag="{Binding OrderId}"
                                            ToolTip="Chon nguoi van chuyen"/>
                                    <Button Content="Huy"
                                            Style="{StaticResource CancelButtonStyle}"
                                            Click="CancelOrder_Click" Tag="{Binding OrderId}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Footer with Statistics -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
            <TextBlock x:Name="OrderCountText" Text="Hien thi: 0 don hang" Style="{StaticResource AdminBodyText}" 
                       VerticalAlignment="Center" Margin="0,0,20,0"/>
            <TextBlock x:Name="FilteredRevenueText" Text="Tong gia tri don hang: 0 VND" Style="{StaticResource AdminBodyText}" 
                       VerticalAlignment="Center" Foreground="{StaticResource AdminPrimaryRed}" FontWeight="SemiBold"/>
        </StackPanel>
    </Grid>
</UserControl>